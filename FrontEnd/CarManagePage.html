<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Car Manage</title>
    <meta content="width=device-width initial-scale=1" name="viewport">
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/StyleSheet_1.css" rel="stylesheet">
    <link href="assets/fonts/css/all.min.css" rel="stylesheet">
</head>
<body style="background-color: #cbced1 !important;">

<header class="p-3 text-bg-dark" style="background-color: rgb(255,255,255) !important;position: absolute;width: 98.9vw !important;">
    <div class="container" style="height: 1vw">
        <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
            <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 text-white text-decoration-none">
                <svg class="bi me-2" width="40" height="32" role="img" aria-label="Bootstrap"><use xlink:href="#bootstrap"></use></svg>
            </a>

            <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0" style="position: absolute;left: 1vw; top: 0">
                <li><a href="AdminDashboardPage.html" class="nav-link px-2 text-white" id="li1" style="color: #535c68 !important;">Dashboard</a></li>
                <li><a href="DriverManagePage.html" class="nav-link px-2 text-white" id="li2" style="color: #535c68 !important;">Drivers</a></li>
                <li><a href="CustomerManagePage.html" class="nav-link px-2 text-white" id="li3" style="color: #535c68 !important;">Customers</a></li>
                <li><a href="CarManagePage.html" class="nav-link px-2 text-white" id="li4" style="color: #EFA80F !important;">Cars</a></li>
                <li><a href="IncomeManagePage.html" class="nav-link px-2 text-white" id="li5" style="color: #535c68 !important;">Income</a></li>
            </ul>
        </div>
    </div>
</header>

<section style="background-color: #ffffff;width: 98.9vw; height: 93vh; position: absolute; top: 7vh;">
    <div style="width: 90%;height: 70%;position: absolute;left:0;top: 0; bottom: 0; right: 0; margin: auto;background: white;box-shadow: 3px 3px 10px #dcdce8;border-radius: 30px;">
        <form class="carForm" id="car_form">
            <div>
                <div class="form-group">
                    <label for="registerNo" id="register_no"  class="carTag">Register No</label>
                    <input class="form-control" id="registerNo" name="register_no" required type="text">
                    <span class="control-error" id="lbl_register_no"></span>
                </div>
            </div>
            <div>
                <div class="form-group">
                    <label for="brand" id="c_brand"  class="carTag">Brand</label>
                    <input class="form-control" id="brand" name="brand" required type="text">
                    <span class="control-error" id="lbl_c_brand"></span>
                </div>
            </div>
            <div>
                <label id="c_type"  class="carTag">Type</label>
                <select class="form-select" name="type" aria-label="Default select example" id="type">
                    <option selected>Not Selected</option>
                    <option value="1">General</option>
                    <option value="2">Premium</option>
                    <option value="2">Luxury</option>
                </select>
            </div>
            <div>
                <div class="form-group">
                    <label for="passengers" id="c_passengers"  class="carTag">No Of Passengers</label>
                    <input class="form-control" id="passengers" name="no_of_passengers" required type="text">
                    <span class="control-error" id="lbl_c_passengers"></span>
                </div>
            </div>
            <div>
                <label id="c_transmission_type"  class="carTag">Transmission Type</label>
                <select class="form-select" name="transmission_type" aria-label="Default select example" id="transmissionType">

                    <option selected>Not Selected</option>
                    <option value="1">Manual</option>
                    <option value="2">Auto</option>
                </select>
            </div>
            <div>
                <label id="c_fuelType" class="carTag">Fuel Type</label>
                <select class="form-select" name="fuel_type" aria-label="Default select example" id="fuelType">
                    <option selected>Not Selected</option>
                    <option value="1">Petrol</option>
                    <option value="2">Diesel</option>
                </select>
            </div>
            <div>
                <div class="form-group">
                    <label for="color" id="c_color"  class="carTag">Color</label>
                    <input class="form-control" id="color" name="color" required type="text">
                    <span class="control-error" id="lbl_c_color"></span>
                </div>
            </div>
            <div>
                <div class="form-group">
                    <label for="dailyRate" id="c_dailyRate"  class="carTag">Daily Rate</label>
                    <input class="form-control" id="dailyRate" name="daily_rate"  required type="text">
                    <span class="control-error" id="lbl_c_dailyRate"></span>
                </div>
            </div>
            <div>
                <div class="form-group">
                    <label for="kmForDay" id="c_kmForDay"  class="carTag">Kilometers For Day</label>
                    <input class="form-control" id="kmForDay" name="km_for_day" required type="text">
                    <span class="control-error" id="lbl_c_kmForDay"></span>
                </div>
            </div>
            <div>
                <div class="form-group">
                    <label for="monthlyRate" id="c_monthlyRate"  class="carTag">Monthly Rate</label>
                    <input class="form-control" id="monthlyRate" name="monthly_rate" required type="text">
                    <span class="control-error" id="lbl_c_monthlyRate"></span>
                </div>
            </div>
            <div>
                <div class="form-group">
                    <label for="kmForMonth" id="c_kmForMonth"  class="carTag">Kilometers For Month</label>
                    <input class="form-control" id="kmForMonth" name="km_for_month" required type="text">
                    <span class="control-error" id="lbl_c_kmForMonth"></span>
                </div>
            </div>
            <div>
                <div class="form-group">
                    <label for="priceForExtraKm" id="c_priceForExtraKm"  class="carTag">Price For Extra Kilometers</label>
                    <input class="form-control" id="priceForExtraKm" name="price_for_extra_km" required type="text">
                    <span class="control-error" id="lbl_c_priceForExtraKm"></span>
                </div>
            </div>
            <div>
                <div class="form-group">
                    <label for="lossDamageWaiver" id="c_LossDamageWaiver"  class="carTag">Loss damage Waiver</label>
                    <input class="form-control" id="lossDamageWaiver" name="loss_damage_waiver"  required type="text">
                    <span class="control-error" id="lbl_c_LossDamageWaiver"></span>
                </div>
            </div>
            <div>
                <label id="c_frontView"  class="carTag">Image Of Front view</label>
                <div class="mb-3">
                    <input class="form-control" name="front_img" type="file" id="frontView">
                </div>
            </div>
            <div>
                <label id="c_backView"  class="carTag">Image Of Back view</label>
                <div class="mb-3">
                    <input class="form-control" name="back_img" type="file" id="backView">
                </div>
            </div>
            <div>
                <label id="c_sideView"  class="carTag">Image Of Side view</label>
                <div class="mb-3">
                    <input class="form-control" name="side_img" type="file" id="sideView">
                </div>
            </div>
            <div>
                <label id="c_interior"  class="carTag">Image Of Interior</label>
                <div class="mb-3">
                    <input class="form-control" name="interior_img" type="file" id="interior">
                </div>
            </div>
            <div></div>
            <div></div>
            <div></div>
        </form>
        <section style="width: 90%;height: 15%;position: absolute;bottom: 0;left: 0;right: 0;margin: auto; background-color: rgba(255,255,255,0)">
            <div>
                <button id="btnCarSave">Save</button>
            </div>
            <div>
                <button id="btnCarUpdate">Update</button>
            </div>
            <div>
                <button id="btnCarDelete">Delete</button>
            </div>
        </section>
    </div>
</section>


<section style="background-color: #ffffff;width: 98.9vw; height: 100vh; position: absolute; top: 100vh;">
    <section id="cb2" style="height: 100%;/*padding-top: 4vh;padding-bottom: 4vh;*/width: 91vw;position: relative;margin: auto;top: 0;left: 0;right: 0;bottom: 0;overflow-y: scroll">
        <table class="table table-bordered table-hover" id="table">
            <thead class="bg-danger text-white" id="tableHeader" style="background-color: #efa80f !important;">
            <tr>
                <th class="carCol">Register No</th>
                <th class="carCol">Brand</th>
                <th class="carCol">Type</th>
                <th class="carCol">No Of Passengers</th>
                <th class="carCol">Transmission Type</th>
                <th class="carCol">Fuel Type</th>
                <th class="carCol">Color</th>
                <th class="carCol">Daily Rate</th>
                <th class="carCol">Kilometers for Day</th>
                <th class="carCol">Monthly Rate</th>
                <th class="carCol">Kilometers For Month</th>
                <th class="carCol">Price For Extra Kilometers</th>
                <th class="carCol">Loss damage Waiver</th>
            </tr>
            </thead>
            <tbody id="tblCar">
            </tbody>
        </table>
    </section>
</section>


<script src="assets/js/jquery-3.6.1.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>

<script>
    let baseURL="http://localhost:8080/BackEnd_war/";

    loadAllCars();

    function loadAllCars(){
        $('#tblCar').empty();
        $.ajax({
            url: baseURL+'car',
            method: 'get',
            dataType: 'json',
            success: function (resp) {
                for (let c of resp.data) {
                    var row = '<tr><td>'+c.register_no+'</td><td>'+c.brand+'</td><td>'+c.type+'</td><td>'+c.no_of_passengers+'</td><td>'+c.transmission_type+'</td><td>'+c.fuel_type+'</td><td>'+c.color+'</td><td>'+c.daily_rate+'</td><td>'+c.km_for_day+'</td><td>'+c.monthly_rate+'</td><td>'+c.km_for_month+'</td><td>'+c.price_for_extra_km+'</td><td>'+c.loss_damage_waiver+'</td></tr>'
                    $('#tblCar').append(row);
                }
                bindRowClickEvents();
                setTextFieldValues("","","","","","","","","","","","","");
            }
        });
    }

    function bindRowClickEvents() {
        $("#tblCar>tr").click(function () {
            let regNo = $(this).children(":eq(0)").text();
            let brand = $(this).children(":eq(1)").text();
            let type = $(this).children(":eq(2)").text();
            let noOfPassengers = $(this).children(":eq(3)").text();
            let transmissionType = $(this).children(":eq(4)").text();
            let fuelType = $(this).children(":eq(5)").text();
            let color = $(this).children(":eq(6)").text();
            let dailyRate = $(this).children(":eq(7)").text();
            let kmForDay = $(this).children(":eq(8)").text();
            let monthlyRate = $(this).children(":eq(9)").text();
            let kamForMonth = $(this).children(":eq(10)").text();
            let priceForExtra = $(this).children(":eq(11)").text();
            let lossDamage = $(this).children(":eq(12)").text();
            // console.log(id, name, address, salary);

            //setting table details values to text fields
            $('#registerNo').val(regNo);
            $('#brand').val(brand);
            $('#type').val(type);
            $('#passengers').val(noOfPassengers);
            $('#transmissionType').val(transmissionType);
            $('#fuelType').val(fuelType);
            $('#color').val(color);
            $('#dailyRate').val(dailyRate);
            $('#kmForDay').val(kmForDay);
            $('#monthlyRate').val(monthlyRate);
            $('#kmForMonth').val(kamForMonth);
            $('#priceForExtraKm').val(priceForExtra);
            $('#lossDamageWaiver').val(lossDamage);

        });
    }

    function setTextFieldValues(regNo, brand, type, noOfPassengers,transmissionType, fuelType,color,dailyRate,kmForDay,monthlyRate,kamForMonth, priceForExtra,lossDamage) {
        $('#registerNo').val(regNo);
        $('#brand').val(brand);
        $('#type').val(type);
        $('#passengers').val(noOfPassengers);
        $('#transmissionType').val(transmissionType);
        $('#fuelType').val(fuelType);
        $('#color').val(color);
        $('#dailyRate').val(dailyRate);
        $('#kmForDay').val(kmForDay);
        $('#monthlyRate').val(monthlyRate);
        $('#kmForMonth').val(kamForMonth);
        $('#priceForExtraKm').val(priceForExtra);
        $('#lossDamageWaiver').val(lossDamage);
    }


    $("#btnCarSave").click(function () {

        var name= $("carBrand").val();
        console.log(name);

        var formData = $("#car_form").serialize();

        console.log(formData);

        $.ajax({
            url: baseURL+"car",
            method: "post",
            data: formData,
            dataType:"json",
            success: function (res) {
                loadAllCars();
                alert(res.message);
            },
            error:function(error){
                var jsObject=JSON.parse(error.responseText);
                alert(jsObject.message);
            }
        });
    });


    $("#btnCarUpdate").click(function () {
        let regNo = $("#registerNo").val();
        let brand = $("#brand").val();
        let type = $("#type").val();
        let noOfPassengers = $("#passengers").val();
        let transmissionType = $("#transmissionType").val();
        let fuelType = $("#fuelType").val();
        let color = $("#color").val();
        let dailyRate = $("#dailyRate").val();
        let kmForDay = $("#kmForDay").val();
        let monthlyRate = $("#monthlyRate").val();
        let kamForMonth = $("#kmForMonth").val();
        let priceForExtra = $("#priceForExtraKm").val();
        let lossDamage = $("#lossDamageWaiver").val();


        var car = {
            registerNo: regNo,
            brand:brand,
            type:type,
            passengers: noOfPassengers,
            transmissionType:transmissionType,
            fuelType:fuelType,
            color: color,
            dailyRate:dailyRate,
            kmForDay:kmForDay,
            monthlyRate: monthlyRate,
            kmForMonth:kamForMonth,
            priceForExtraKm:priceForExtra,
            lossDamageWaiver:lossDamage

        }

        $.ajax({
            url: baseURL+'car',
            method: 'put',
            contentType:"application/json",
            data:JSON.stringify(car),
            dataType:"json",
            success: function (res) {
                alert(res.message);
                loadAllCars();
            },
            error:function (error){
                let cause= JSON.parse(error.responseText).message;
                alert(cause);
            }

        });
    });


</script>
</body>
</html>