<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Driver Manage</title>
    <meta content="width=device-width initial-scale=1" name="viewport">
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/StyleSheet_1.css" rel="stylesheet">
    <link href="assets/fonts/css/all.min.css" rel="stylesheet">
</head>
<body style="background-color: #cbced1 !important;">

<header class="p-3 text-bg-dark" style="background-color: rgb(255,255,255) !important;position: absolute;width: 100vw !important;">
    <div class="container" style="height: 1vw">
        <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
            <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 text-white text-decoration-none">
                <svg class="bi me-2" width="40" height="32" role="img" aria-label="Bootstrap"><use xlink:href="#bootstrap"></use></svg>
            </a>

            <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0" style="position: absolute;left: 1vw; top: 0">
                <li><a href="AdminDashboardPage.html" class="nav-link px-2 text-white" id="li1" style="color: #535c68 !important;">Dashboard</a></li>
                <li><a href="DriverManagePage.html" class="nav-link px-2 text-white" id="li2" style="color: #EFA80F !important;">Drivers</a></li>
                <li><a href="CustomerManagePage.html" class="nav-link px-2 text-white" id="li3" style="color: #535c68 !important;">Customers</a></li>
                <li><a href="CarManagePage.html" class="nav-link px-2 text-white" id="li4" style="color: #535c68 !important;">Cars</a></li>
                <li><a href="IncomeManagePage.html" class="nav-link px-2 text-white" id="li5" style="color: #535c68 !important;">Income</a></li>
            </ul>
        </div>
    </div>
</header>

<section style="background-color: #ffffff;width: 100vw; height: 93vh; position: relative; top: 7vh;">

    <div style="width: 35vw;height: 80vh;position: absolute;left: 1%;top: 0; bottom: 0;margin: auto;background: white;box-shadow: 3px 3px 10px #dcdce8;border-radius: 30px;">


        <form id="driver_form" style="width: 32vw;height: 70vh;position: absolute;left: 0;right: 0;top: -15px;bottom: 0;margin: auto;background: #ffffff; display: grid;grid-template-rows: repeat(7,1fr);grid-template-columns: repeat(1,1fr);gap: 2px;">

            <div>
                <div class="form-group">
                    <label for="driverId" id="d_id" class="tag2" style="top: 2vh; left: 1.5vw">Driver ID</label>
                    <input class="form-control" id="driverId" name="d_id"  required type="text" style="width: 30vw;height: 4.5vh;position: relative;background-color: white;border: 1px solid #EFA80F;top: 15px;left: 0;right: 0;margin: auto;border-radius: 25px; ">
                    <span class="control-error" id="lbl_d_id"></span>
                </div>
            </div>
            <div>
                <div class="form-group">
                    <label for="driverName" id="d_name" class="tag2" style="top: 2vh; left: 1.5vw">Name</label>
                    <input class="form-control" id="driverName" name="d_name"  required type="text" style="width: 30vw;height: 4.5vh;position: relative;background-color: white;border: 1px solid #EFA80F;top: 15px;left: 0;right: 0;margin: auto;border-radius: 25px; ">
                    <span class="control-error" id="lbl_d_name"></span>
                </div>
            </div>
            <div>
                <div class="form-group">
                    <label for="driverNic" id="d_nic" class="tag2" style="top: 2vh; left: 1.5vw">NIC</label>
                    <input class="form-control" id="driverNic" name="d_nic"  required type="text" style="width: 30vw;height: 4.5vh;position: relative;background-color: white;border: 1px solid #EFA80F;top: 15px;left: 0;right: 0;margin: auto;border-radius: 25px; ">
                    <span class="control-error" id="lbl_d_nic"></span>
                </div>
            </div>
            <div>
                <div class="form-group">
                    <label for="driverLicenseNo" id="d_license_no" class="tag2" style="top: 2vh; left: 1.5vw">License No</label>
                    <input class="form-control" id="driverLicenseNo" name="d_license_no"  required type="text" style="width: 30vw;height: 4.5vh;position: relative;background-color: white;border: 1px solid #EFA80F;top: 15px;left: 0;right: 0;margin: auto;border-radius: 25px; ">
                    <span class="control-error" id="lbl_d_license_no"></span>
                </div>
            </div>
            <div>
                <div class="form-group">
                    <label for="driverContactNo" id="d_contact_no" class="tag2" style="top: 2vh; left: 1.5vw">Contact No</label>
                    <input class="form-control" id="driverContactNo" name="d_contact_no"  required type="text" style="width: 30vw;height: 4.5vh;position: relative;background-color: white;border: 1px solid #EFA80F;top: 15px;left: 0;right: 0;margin: auto;border-radius: 25px; ">
                    <span class="control-error" id="lbl_d_contact_no"></span>
                </div>
            </div>
            <div>
                <div class="form-group">
                    <label for="driverAddress" id="d_address" class="tag2" style="top: 2vh; left: 1.5vw">Address</label>
                    <input class="form-control" id="driverAddress" name="d_address"  required type="text" style="width: 30vw;height: 4.5vh;position: relative;background-color: white;border: 1px solid #EFA80F;top: 15px;left: 0;right: 0;margin: auto;border-radius: 25px; ">
                    <span class="control-error" id="lbl_d_address"></span>
                </div>
            </div>

        </form>

        <div style="display: grid;grid-template-rows: repeat(1,1fr);grid-template-columns: repeat(3,1fr);gap: 2px;position: relative;top: 70vh;left: 0 !important;right: 0 !important;margin: auto !important;width: 30vw !important">

            <div>
                <button id="btnSave" style="background-color: #16a085 !important;">Save</button>
            </div>
            <div>
                <button id="btnUpdate" style="background-color: #EFA80F !important;">Update</button>
            </div>
            <div>
                <button id="btnDelete" style="background-color: #eb3b5a !important;">Delete</button>
            </div>

        </div>


    </div>
    <img src="assets/images/driverAdd.png" alt="" style="position: absolute;width: 21vw;top: 3vh;left: 57vw;">
    <div style="width: 60vw;height: 53vh;position: absolute;right: 1%;bottom: 7vh; background: white;box-shadow: 3px 3px 10px #dcdce8;border-radius: 30px;">

        <section id="cb2" style="height: 100%;padding-top: 5vh;padding-bottom: 5vh;width: 92%;position: relative;margin: auto;top: 0;left: 0;right: 0;bottom: 0;">
            <table class="table table-bordered table-hover" id="table">
                <thead class="bg-danger text-white" id="tableHeader" style="background-color: #efa80f !important;">
                <tr>
                    <th>Diver ID</th>
                    <th>Name</th>
                    <th>NIC</th>
                    <th>License NO</th>
                    <th>Contact No</th>
                    <th>Address</th>
                </tr>
                </thead>
                <tbody id="tblDriver">
                </tbody>
            </table>
        </section>

    </div>
    

</section>



<script src="assets/js/jquery-3.6.1.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>


<script>

    let baseURL="http://localhost:8080/BackEnd_war/";



    loadAllDrivers();

    //Add customer to the database

    $("#btnSave").click(function () {

        var name= $("driverName").val();
        console.log(name);

        var formData = $("#driver_form").serialize();
        // will generate a query String including form data

        console.log(formData);
        //send ajax request to the customer servlet


        $.ajax({
            url: baseURL+"driver",
            method: "post",
            data: formData,
            dataType:"json",
            success: function (res) {
                loadAllDrivers();
                alert(res.message);
            },
            error:function(error){
                var jsObject=JSON.parse(error.responseText);
                alert(jsObject.message);
            }
        });
    });

    /*$("#btnSave").click(function () {

        var formData = $("#driver_form").serialize();
        // will generate a query String including form data

        //send ajax request to the customer servlet
        $.ajax({
            url: baseURL+"driver",
            method: "post",
            data: formData,
            dataType:"json",
            success: function (res) {
                loadAllDrivers();
                alert(res.message);
            },
            error:function(error){
                var jsObject=JSON.parse(error.responseText);
                alert(jsObject.message);
            }
        });
    });*/



    function loadAllDrivers(){
        $('#tblDriver').empty();
        $.ajax({
            url: baseURL+'driver',
            method: 'get',
            dataType: 'json',
            success: function (resp) {
                for (let d of resp.data) {
                    var row = '<tr><td>'+d.d_id+'</td><td>'+d.d_name+'</td><td>'+d.d_nic+'</td><td>'+d.d_license_no+'</td><td>'+d.d_contact_no+'</td><td>'+d.d_address+'</td></tr>'
                    $('#tblDriver').append(row);
                }
                bindRowClickEvents();
                setTextFieldValues("","","","","","");
            }
        });
    }

    /*function loadAllDrivers() {
        $("#tblDriver").empty();
        $.ajax({
            url: baseURL+"driver",
            dataType: "json",
            success: function (resp) {
                console.log(resp);
                for (let driver of resp.data) {
                    var row = '<tr><td>' + driver.d_id + '</td><td>' + driver.d_name + '</td><td>' + driver.d_nic + '</td><td>' + driver.d_license_no + '</td></tr>' + driver.d_contact_no + '</td><td>' + driver.d_address + '</td></tr>';
                    $("#tblDriver").append(row);
                }
                bindRowClickEvents();
                setTextFieldValues("","","","","","");
                /!*$("#driverId").focus();*!/
            }
        });
    }*/


    function bindRowClickEvents() {
        $("#tblDriver>tr").click(function () {
            let id = $(this).children(":eq(0)").text();
            let name = $(this).children(":eq(1)").text();
            let nic = $(this).children(":eq(2)").text();
            let license_no = $(this).children(":eq(3)").text();
            let contact_no = $(this).children(":eq(4)").text();
            let address = $(this).children(":eq(5)").text();
            // console.log(id, name, address, salary);

            //setting table details values to text fields
            $('#driverId').val(id);
            $('#driverName').val(name);
            $('#driverNic').val(nic);
            $('#driverLicenseNo').val(license_no);
            $('#driverContactNo').val(contact_no);
            $('#driverAddress').val(address);

        });
    }


    function setTextFieldValues(id, name, nic, license,contact,address) {
        $("#driverId").val(id);
        $("#driverName").val(name);
        $("#driverNic").val(nic);
        $("#driverLicenseNo").val(license);
        $("#driverContactNo").val(contact);
        $("#driverAddress").val(address);
    }


    $("#btnUpdate").click(function () {

        let id = $("#driverId").val();
        let name = $("#driverName").val();
        let nic = $("#driverNic").val();
        let license_no = $("#driverLicenseNo").val();
        let contact_no = $("#driverContactNo").val();
        let address = $("#driverAddress").val();


        var driver = {
            d_id: id,
            d_name: name,
            d_nic: nic,
            d_license_no: license_no,
            d_contact_no: contact_no,
            d_address: address
        }

        $.ajax({
            url: baseURL+'driver',
            method: 'put',
            contentType:"application/json",
            data:JSON.stringify(driver),
            dataType:"json",
            success: function (res) {
                alert(res.message);
                loadAllDrivers();
            },
            error:function (error){
                let cause= JSON.parse(error.responseText).message;
                alert(cause);
            }

        });
    });



</script>


</body>
</html>